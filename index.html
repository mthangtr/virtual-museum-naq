<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Bảo tàng Ảo Nguyễn Ái Quốc - Virtual Museum of Nguyen Ai Quoc">
  <title>Bảo tàng Ảo Nguyễn Ái Quốc</title>

  <!-- A-Frame 1.4.0 -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

  <!-- A-Frame Extras (movement controls) -->
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>

  <!-- A-Frame Environment Component -->
  <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>

  <!-- A-Frame Particle System -->
  <script src="https://unpkg.com/aframe-particle-system-component@1.0.11/dist/aframe-particle-system-component.min.js"></script>

  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/popup.css">
  <link rel="stylesheet" href="styles/hud.css">

  <!-- Custom Components (Sprint 2) -->
  <script src="src/components/room-manager.js"></script>
  <script src="src/components/enhanced-camera-controller.js"></script>
  <script src="src/components/door-portal.js"></script>
  <script src="src/components/mobile-touch-controls.js"></script>
  <script src="src/components/teleport-navigation.js"></script>
  <script src="src/components/vietnamese-text.js"></script>

  <!-- Sprint 3 Components: Interactive Object System -->
  <script src="src/components/interactive-object.js"></script>
  <script src="src/components/progress-tracker.js"></script>
  <script src="src/components/click-forwarder.js"></script>
  <script src="src/components/cursor-feedback.js"></script>
  
  <!-- Utilities (Sprint 3) -->
  <script src="src/utils/ui-controller.js"></script>

  <!-- Components to be added in future sprints -->
  <!-- <script src="src/components/transition-effect.js"></script> -->

  <!-- Main App Logic -->
  <!-- <script src="src/main.js"></script> -->
</head>
<body>

  <!-- A-Frame Scene -->
  <a-scene stats>

    <!-- Assets Preloader -->
    <a-assets>
      <!-- Vietnamese Font Support -->
      <img id="font-roboto" src="https://cdn.aframe.io/fonts/Roboto-msdf.png" crossorigin="anonymous">

      <!-- Models will be loaded here -->
      <!-- Textures will be loaded here -->
      <!-- Audio will be loaded here -->
    </a-assets>

    <!-- Room Manager (handles room switching) -->
    <a-entity
      room-manager="
        currentRoom: home;
        rooms: home, room1;
        transitionDuration: 1500;
      ">
    </a-entity>

    <!-- ============================================ -->
    <!-- HOME ROOM (Starting Area) -->
    <!-- ============================================ -->
    <a-entity id="home" visible="true">

      <!-- Sky -->
      <a-sky color="#87CEEB"></a-sky>

      <!-- Ground Plane -->
      <a-plane
        ground
        position="0 0 0"
        rotation="-90 0 0"
        width="50"
        height="50"
        color="#7BC8A4"
        shadow="receive: true">
      </a-plane>

      <!-- Welcome Text with Vietnamese Support -->
      <a-entity
        position="0 2.5 -4"
        vietnamese-text="
          value: Bảo tàng Ảo Nguyễn Ái Quốc\nVirtual Museum\n\nControls:\nWASD - Move\nMouse - Look around\nClick to lock cursor\nC - Crouch\nShift - Sprint\nT - Teleport mode (hold)\nE - Enter door;
          color: #2C3E50;
          fontSize: 0.25;
          align: center;
          width: 6;
        ">
      </a-entity>

      <!-- Test Objects -->
      <a-box
        position="0 1 -8"
        rotation="0 45 0"
        color="#FF6B6B"
        shadow="cast: true">
      </a-box>

      <a-box
        position="3 1 -8"
        rotation="0 0 0"
        color="#4ECDC4"
        shadow="cast: true">
      </a-box>

      <a-sphere
        position="-3 1.5 -8"
        radius="1"
        color="#FFE66D"
        shadow="cast: true">
      </a-sphere>

      <!-- Door to Room 1 -->
      <a-entity
        position="0 0 -10"
        door-portal="
          targetRoom: room1;
          locked: false;
          activationDistance: 3;
        ">
        <!-- Door frame -->
        <a-box
          position="0 1 0"
          width="2"
          height="3"
          depth="0.2"
          color="#8B4513"
          shadow="cast: true">
        </a-box>

        <!-- Door label -->
        <a-entity
          position="0 3.5 0.2"
          vietnamese-text="
            value: Room 1\n1911-1919;
            color: #FFFFFF;
            fontSize: 0.2;
            align: center;
            width: 2;
          ">
        </a-entity>
      </a-entity>

    </a-entity>

    <!-- ============================================ -->
    <!-- ROOM 1 (1911-1919: Khởi hành) -->
    <!-- ============================================ -->
    <a-entity id="room1" visible="false">

      <!-- Progress Tracker for Room 1 -->
      <a-entity
        progress-tracker="
          roomId: room1;
          requiredObjects: 3;
          objects: obj-room1-ship, obj-room1-map, obj-room1-diary;
          enablePersistence: true;
          autoUnlockDoor: true;
        ">
      </a-entity>

      <!-- Sky (different color) -->
      <a-sky color="#1976D2"></a-sky>

      <!-- Ground Plane -->
      <a-plane
        ground
        position="0 0 0"
        rotation="-90 0 0"
        width="50"
        height="50"
        color="#4A90E2"
        shadow="receive: true">
      </a-plane>

      <!-- Room Title with Vietnamese Support -->
      <a-entity
        position="0 2.5 -4"
        vietnamese-text="
          value: Phòng 1: 1911-1919\nKhởi hành\n\nNhấp vào 3 hiện vật để tiếp tục;
          color: #FFFFFF;
          fontSize: 0.3;
          align: center;
          width: 6;
        ">
      </a-entity>

      <!-- Interactive Object 1: Tàu Ba Son (Ship) -->
      <a-entity position="0 1 -6">
        <!-- Visible object -->
        <a-cylinder
          radius="0.5"
          height="2"
          color="#C62828"
          shadow="cast: true"
          class="interactive"
          interactive-object="
            objectId: obj-room1-ship;
            title: Tàu Ba Son;
            description: Ngày 5/6/1911, Nguyễn Ái Quốc rời cảng Sài Gòn trên tàu Amiral Latouche-Tréville với tư cách thợ phụ bếp, bắt đầu cuộc hành trình 30 năm đi tìm con đường cứu nước.\n\n'Tôi muốn đi ra nước ngoài để xem các nước khác họ làm thế nào, rồi về giúp đồng bào mình.';
            image: ;
            highlightColor: #FFD700;
            highlightIntensity: 1.5;
          ">
        </a-cylinder>
        <!-- Invisible larger collision box for easier clicking -->
        <a-box
          class="clickable"
          width="2"
          height="3"
          depth="2"
          opacity="0"
          material="transparent: true; visible: false"
          data-interactive-target="obj-room1-ship"
          click-forwarder>
        </a-box>
      </a-entity>

      <!-- Interactive Object 2: Bản đồ (World Map) -->
      <a-entity position="2.5 1.5 -6">
        <!-- Visible object -->
        <a-torus
          radius="0.8"
          radius-tubular="0.2"
          color="#FFD700"
          shadow="cast: true"
          class="interactive"
          interactive-object="
            objectId: obj-room1-map;
            title: Bản đồ thế giới;
            description: Từ 1911-1919, Nguyễn Ái Quốc đã đi qua nhiều nước: Pháp, Anh, Mỹ, Phi châu... Người quan sát cuộc sống của người dân bị áp bức ở các thuộc địa, tìm hiểu phong trào đấu tranh giải phóng dân tộc.\n\n'Tôi đã đi khắp năm châu để nghiên cứu, để học hỏi.';
            image: ;
            highlightColor: #FFD700;
            highlightIntensity: 1.5;
          ">
        </a-torus>
        <!-- Invisible larger collision box for easier clicking -->
        <a-box
          class="clickable"
          width="2.5"
          height="2.5"
          depth="2.5"
          opacity="0"
          material="transparent: true; visible: false"
          data-interactive-target="obj-room1-map"
          click-forwarder>
        </a-box>
      </a-entity>

      <!-- Interactive Object 3: Nhật ký (Diary) -->
      <a-entity position="-2.5 1 -6">
        <!-- Visible object -->
        <a-cone
          radius-bottom="0.8"
          radius-top="0"
          height="2"
          color="#4ECDC4"
          shadow="cast: true"
          class="interactive"
          interactive-object="
            objectId: obj-room1-diary;
            title: Nhật ký hành trình;
            description: Tại Hội nghị Versailles năm 1919, Nguyễn Ái Quốc đã nộp 'Bản yêu sách 8 điểm' đòi quyền tự do, dân chủ cho nhân dân Việt Nam. Đây là lần đầu tiên tiếng nói của người Việt được vang lên tại một diễn đàn quốc tế.\n\n'Tôi muốn tìm một con đường mới để cứu dân tộc.';
            image: ;
            highlightColor: #FFD700;
            highlightIntensity: 1.5;
          ">
        </a-cone>
        <!-- Invisible larger collision box for easier clicking -->
        <a-box
          class="clickable"
          width="2.5"
          height="3"
          depth="2.5"
          opacity="0"
          material="transparent: true; visible: false"
          data-interactive-target="obj-room1-diary"
          click-forwarder>
        </a-box>
      </a-entity>

      <!-- Door to Room 2 (locked initially) -->
      <a-entity
        position="0 0 -12"
        door-portal="
          targetRoom: home;
          locked: true;
          activationDistance: 3;
        ">
        <!-- Door frame -->
        <a-box
          position="0 1 0"
          width="2"
          height="3"
          depth="0.2"
          color="#8B4513"
          shadow="cast: true">
        </a-box>

        <!-- Door label -->
        <a-entity
          position="0 3.5 0.2"
          vietnamese-text="
            value: Phòng tiếp theo\n(Hoàn thành 3/3 hiện vật);
            color: #FFFFFF;
            fontSize: 0.2;
            align: center;
            width: 3;
          ">
        </a-entity>
      </a-entity>

      <!-- Door back to Home -->
      <a-entity
        position="0 0 5"
        rotation="0 180 0"
        door-portal="
          targetRoom: home;
          locked: false;
          activationDistance: 3;
        ">
        <!-- Door frame -->
        <a-box
          position="0 1 0"
          width="2"
          height="3"
          depth="0.2"
          color="#8B4513"
          shadow="cast: true">
        </a-box>

        <!-- Door label -->
        <a-entity
          position="0 3.5 0.2"
          vietnamese-text="
            value: Trở về Home;
            color: #FFFFFF;
            fontSize: 0.2;
            align: center;
            width: 2;
          ">
        </a-entity>
      </a-entity>

    </a-entity>

    <!-- ============================================ -->
    <!-- CAMERA RIG (Enhanced Controls) -->
    <!-- ============================================ -->
    <a-entity
      id="rig"
      position="0 1.6 0"
      movement-controls="
        fly: false;
        speed: 0.15;
        constrainToNavMesh: false;
      ">

      <a-camera
        id="camera"
        look-controls="
          pointerLockEnabled: true;
          magicWindowTrackingEnabled: true;
          touchEnabled: true;
          mouseEnabled: true;
        "
        fov="75"
        near="0.1"
        far="100"
        raycaster="
          objects: .interactive, .clickable;
          far: 10;
          interval: 50;
        "
        cursor="
          fuse: false;
          rayOrigin: mouse;
          fuseTimeout: 1500;
        ">
        <!-- Cursor visual feedback (center of screen) -->
        <a-entity
          position="0 0 -0.5"
          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
          material="color: white; shader: flat; opacity: 0.9"
          id="cursor-ring"
          cursor-feedback>
        </a-entity>
      </a-camera>

    </a-entity>

    <!-- Mobile Touch Controls (separate entity) -->
    <a-entity
      mobile-touch-controls="
        enabled: true;
        movementSpeed: 3.5;
        lookSensitivity: 0.003;
      ">
    </a-entity>

    <!-- Teleport Navigation (separate entity) -->
    <a-entity
      teleport-navigation="
        enabled: true;
        maxDistance: 10;
        transitionDuration: 800;
      ">
    </a-entity>

    <!-- Lighting System -->
    <!-- Ambient Light (overall illumination) -->
    <a-entity
      light="
        type: ambient;
        color: #FFFFFF;
        intensity: 0.6;
      ">
    </a-entity>

    <!-- Directional Light (simulating sun) -->
    <a-entity
      light="
        type: directional;
        color: #FFFFFF;
        intensity: 0.8;
        castShadow: true;
        shadowMapHeight: 1024;
        shadowMapWidth: 1024;
      "
      position="5 10 5">
    </a-entity>

    <!-- Hemisphere Light (sky/ground gradient) -->
    <a-entity
      light="
        type: hemisphere;
        color: #87CEEB;
        groundColor: #7BC8A4;
        intensity: 0.5;
      ">
    </a-entity>

  </a-scene>

  <!-- HUD Overlay -->
  <div id="hud">
    <div id="header">
      <span id="museum-title">Bảo tàng Ảo Nguyễn Ái Quốc</span>
      <div class="header-controls">
        <button class="header-button icon-button" id="audio-toggle" title="Toggle Audio">🔊</button>
        <button class="header-button icon-button" id="help-button" title="Help">❓</button>
      </div>
    </div>
    <div id="crosshair"></div>
    <div id="footer">
      <span id="room-name">Phòng Khởi đầu</span>
      <span id="progress">0/3</span>
    </div>
  </div>

</body>
</html>
