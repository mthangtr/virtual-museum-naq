<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="B·∫£o t√†ng ·∫¢o Nguy·ªÖn √Åi Qu·ªëc - Virtual Museum of Nguyen Ai Quoc">
  <title>B·∫£o t√†ng ·∫¢o Nguy·ªÖn √Åi Qu·ªëc</title>

  <!-- A-Frame 1.4.0 -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

  <!-- A-Frame Extras (movement controls) -->
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>

  <!-- A-Frame Environment Component -->
  <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>

  <!-- A-Frame Particle System -->
  <script src="https://unpkg.com/aframe-particle-system-component@1.0.11/dist/aframe-particle-system-component.min.js"></script>

  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/popup.css">
  <link rel="stylesheet" href="styles/hud.css">

  <!-- Custom Components (Sprint 2) -->
  <script src="src/components/room-manager.js"></script>
  <script src="src/components/enhanced-camera-controller.js"></script>
  <script src="src/components/door-portal.js"></script>
  <script src="src/components/mobile-touch-controls.js"></script>
  <script src="src/components/teleport-navigation.js"></script>
  <script src="src/components/vietnamese-text.js"></script>

  <!-- Sprint 3 Components: Interactive Object System -->
  <script src="src/components/interactive-object.js"></script>
  <script src="src/components/progress-tracker.js"></script>
  <script src="src/components/click-forwarder.js"></script>
  <script src="src/components/cursor-feedback.js"></script>
  
  <!-- Utilities (Sprint 3) -->
  <script src="src/utils/ui-controller.js"></script>

  <!-- Components to be added in future sprints -->
  <!-- <script src="src/components/transition-effect.js"></script> -->

  <!-- Main App Logic -->
  <!-- <script src="src/main.js"></script> -->
</head>
<body>

  <!-- A-Frame Scene -->
  <a-scene stats>

    <!-- Assets Preloader -->
    <a-assets>
      <!-- Vietnamese Font Support -->
      <img id="font-roboto" src="https://cdn.aframe.io/fonts/Roboto-msdf.png" crossorigin="anonymous">

      <!-- Models will be loaded here -->
      <!-- Textures will be loaded here -->
      <!-- Audio will be loaded here -->
    </a-assets>

    <!-- Room Manager (handles room switching) -->
    <a-entity
      room-manager="
        currentRoom: home;
        rooms: home, room1;
        transitionDuration: 1500;
      ">
    </a-entity>

    <!-- ============================================ -->
    <!-- HOME ROOM (Starting Area) -->
    <!-- ============================================ -->
    <a-entity id="home" visible="true">

      <!-- Sky -->
      <a-sky color="#87CEEB"></a-sky>

      <!-- Ground Plane -->
      <a-plane
        ground
        position="0 0 0"
        rotation="-90 0 0"
        width="50"
        height="50"
        color="#7BC8A4"
        shadow="receive: true">
      </a-plane>

      <!-- Welcome Text with Vietnamese Support -->
      <a-entity
        position="0 2.5 -4"
        vietnamese-text="
          value: B·∫£o t√†ng ·∫¢o Nguy·ªÖn √Åi Qu·ªëc\nVirtual Museum\n\nControls:\nWASD - Move\nMouse - Look around\nClick to lock cursor\nC - Crouch\nShift - Sprint\nT - Teleport mode (hold)\nE - Enter door;
          color: #2C3E50;
          fontSize: 0.25;
          align: center;
          width: 6;
        ">
      </a-entity>

      <!-- Test Objects -->
      <a-box
        position="0 1 -8"
        rotation="0 45 0"
        color="#FF6B6B"
        shadow="cast: true">
      </a-box>

      <a-box
        position="3 1 -8"
        rotation="0 0 0"
        color="#4ECDC4"
        shadow="cast: true">
      </a-box>

      <a-sphere
        position="-3 1.5 -8"
        radius="1"
        color="#FFE66D"
        shadow="cast: true">
      </a-sphere>

      <!-- Door to Room 1 -->
      <a-entity
        position="0 0 -10"
        door-portal="
          targetRoom: room1;
          locked: false;
          activationDistance: 3;
        ">
        <!-- Door frame -->
        <a-box
          position="0 1 0"
          width="2"
          height="3"
          depth="0.2"
          color="#8B4513"
          shadow="cast: true">
        </a-box>

        <!-- Door label -->
        <a-entity
          position="0 3.5 0.2"
          vietnamese-text="
            value: Room 1\n1911-1919;
            color: #FFFFFF;
            fontSize: 0.2;
            align: center;
            width: 2;
          ">
        </a-entity>
      </a-entity>

    </a-entity>

    <!-- ============================================ -->
    <!-- ROOM 1 (1911-1919: Kh·ªüi h√†nh) -->
    <!-- ============================================ -->
    <a-entity id="room1" visible="false">

      <!-- Progress Tracker for Room 1 -->
      <a-entity
        progress-tracker="
          roomId: room1;
          requiredObjects: 3;
          objects: obj-room1-ship, obj-room1-map, obj-room1-diary;
          enablePersistence: true;
          autoUnlockDoor: true;
        ">
      </a-entity>

      <!-- Sky (different color) -->
      <a-sky color="#1976D2"></a-sky>

      <!-- Ground Plane -->
      <a-plane
        ground
        position="0 0 0"
        rotation="-90 0 0"
        width="50"
        height="50"
        color="#4A90E2"
        shadow="receive: true">
      </a-plane>

      <!-- Room Title with Vietnamese Support -->
      <a-entity
        position="0 2.5 -4"
        vietnamese-text="
          value: Ph√≤ng 1: 1911-1919\nKh·ªüi h√†nh\n\nNh·∫•p v√†o 3 hi·ªán v·∫≠t ƒë·ªÉ ti·∫øp t·ª•c;
          color: #FFFFFF;
          fontSize: 0.3;
          align: center;
          width: 6;
        ">
      </a-entity>

      <!-- Interactive Object 1: T√†u Ba Son (Ship) -->
      <a-entity position="0 1 -6">
        <!-- Visible object -->
        <a-cylinder
          radius="0.5"
          height="2"
          color="#C62828"
          shadow="cast: true"
          class="interactive"
          interactive-object="
            objectId: obj-room1-ship;
            title: T√†u Ba Son;
            description: Ng√†y 5/6/1911, Nguy·ªÖn √Åi Qu·ªëc r·ªùi c·∫£ng S√†i G√≤n tr√™n t√†u Amiral Latouche-Tr√©ville v·ªõi t∆∞ c√°ch th·ª£ ph·ª• b·∫øp, b·∫Øt ƒë·∫ßu cu·ªôc h√†nh tr√¨nh 30 nƒÉm ƒëi t√¨m con ƒë∆∞·ªùng c·ª©u n∆∞·ªõc.\n\n'T√¥i mu·ªën ƒëi ra n∆∞·ªõc ngo√†i ƒë·ªÉ xem c√°c n∆∞·ªõc kh√°c h·ªç l√†m th·∫ø n√†o, r·ªìi v·ªÅ gi√∫p ƒë·ªìng b√†o m√¨nh.';
            image: ;
            highlightColor: #FFD700;
            highlightIntensity: 1.5;
          ">
        </a-cylinder>
        <!-- Invisible larger collision box for easier clicking -->
        <a-box
          class="clickable"
          width="2"
          height="3"
          depth="2"
          opacity="0"
          material="transparent: true; visible: false"
          data-interactive-target="obj-room1-ship"
          click-forwarder>
        </a-box>
      </a-entity>

      <!-- Interactive Object 2: B·∫£n ƒë·ªì (World Map) -->
      <a-entity position="2.5 1.5 -6">
        <!-- Visible object -->
        <a-torus
          radius="0.8"
          radius-tubular="0.2"
          color="#FFD700"
          shadow="cast: true"
          class="interactive"
          interactive-object="
            objectId: obj-room1-map;
            title: B·∫£n ƒë·ªì th·∫ø gi·ªõi;
            description: T·ª´ 1911-1919, Nguy·ªÖn √Åi Qu·ªëc ƒë√£ ƒëi qua nhi·ªÅu n∆∞·ªõc: Ph√°p, Anh, M·ªπ, Phi ch√¢u... Ng∆∞·ªùi quan s√°t cu·ªôc s·ªëng c·ªßa ng∆∞·ªùi d√¢n b·ªã √°p b·ª©c ·ªü c√°c thu·ªôc ƒë·ªãa, t√¨m hi·ªÉu phong tr√†o ƒë·∫•u tranh gi·∫£i ph√≥ng d√¢n t·ªôc.\n\n'T√¥i ƒë√£ ƒëi kh·∫Øp nƒÉm ch√¢u ƒë·ªÉ nghi√™n c·ª©u, ƒë·ªÉ h·ªçc h·ªèi.';
            image: ;
            highlightColor: #FFD700;
            highlightIntensity: 1.5;
          ">
        </a-torus>
        <!-- Invisible larger collision box for easier clicking -->
        <a-box
          class="clickable"
          width="2.5"
          height="2.5"
          depth="2.5"
          opacity="0"
          material="transparent: true; visible: false"
          data-interactive-target="obj-room1-map"
          click-forwarder>
        </a-box>
      </a-entity>

      <!-- Interactive Object 3: Nh·∫≠t k√Ω (Diary) -->
      <a-entity position="-2.5 1 -6">
        <!-- Visible object -->
        <a-cone
          radius-bottom="0.8"
          radius-top="0"
          height="2"
          color="#4ECDC4"
          shadow="cast: true"
          class="interactive"
          interactive-object="
            objectId: obj-room1-diary;
            title: Nh·∫≠t k√Ω h√†nh tr√¨nh;
            description: T·∫°i H·ªôi ngh·ªã Versailles nƒÉm 1919, Nguy·ªÖn √Åi Qu·ªëc ƒë√£ n·ªôp 'B·∫£n y√™u s√°ch 8 ƒëi·ªÉm' ƒë√≤i quy·ªÅn t·ª± do, d√¢n ch·ªß cho nh√¢n d√¢n Vi·ªát Nam. ƒê√¢y l√† l·∫ßn ƒë·∫ßu ti√™n ti·∫øng n√≥i c·ªßa ng∆∞·ªùi Vi·ªát ƒë∆∞·ª£c vang l√™n t·∫°i m·ªôt di·ªÖn ƒë√†n qu·ªëc t·∫ø.\n\n'T√¥i mu·ªën t√¨m m·ªôt con ƒë∆∞·ªùng m·ªõi ƒë·ªÉ c·ª©u d√¢n t·ªôc.';
            image: ;
            highlightColor: #FFD700;
            highlightIntensity: 1.5;
          ">
        </a-cone>
        <!-- Invisible larger collision box for easier clicking -->
        <a-box
          class="clickable"
          width="2.5"
          height="3"
          depth="2.5"
          opacity="0"
          material="transparent: true; visible: false"
          data-interactive-target="obj-room1-diary"
          click-forwarder>
        </a-box>
      </a-entity>

      <!-- Door to Room 2 (locked initially) -->
      <a-entity
        position="0 0 -12"
        door-portal="
          targetRoom: home;
          locked: true;
          activationDistance: 3;
        ">
        <!-- Door frame -->
        <a-box
          position="0 1 0"
          width="2"
          height="3"
          depth="0.2"
          color="#8B4513"
          shadow="cast: true">
        </a-box>

        <!-- Door label -->
        <a-entity
          position="0 3.5 0.2"
          vietnamese-text="
            value: Ph√≤ng ti·∫øp theo\n(Ho√†n th√†nh 3/3 hi·ªán v·∫≠t);
            color: #FFFFFF;
            fontSize: 0.2;
            align: center;
            width: 3;
          ">
        </a-entity>
      </a-entity>

      <!-- Door back to Home -->
      <a-entity
        position="0 0 5"
        rotation="0 180 0"
        door-portal="
          targetRoom: home;
          locked: false;
          activationDistance: 3;
        ">
        <!-- Door frame -->
        <a-box
          position="0 1 0"
          width="2"
          height="3"
          depth="0.2"
          color="#8B4513"
          shadow="cast: true">
        </a-box>

        <!-- Door label -->
        <a-entity
          position="0 3.5 0.2"
          vietnamese-text="
            value: Tr·ªü v·ªÅ Home;
            color: #FFFFFF;
            fontSize: 0.2;
            align: center;
            width: 2;
          ">
        </a-entity>
      </a-entity>

    </a-entity>

    <!-- ============================================ -->
    <!-- CAMERA RIG (Enhanced Controls) -->
    <!-- ============================================ -->
    <a-entity
      id="rig"
      position="0 1.6 0"
      movement-controls="
        fly: false;
        speed: 0.15;
        constrainToNavMesh: false;
      ">

      <a-camera
        id="camera"
        look-controls="
          pointerLockEnabled: true;
          magicWindowTrackingEnabled: true;
          touchEnabled: true;
          mouseEnabled: true;
        "
        fov="75"
        near="0.1"
        far="100"
        raycaster="
          objects: .interactive, .clickable;
          far: 10;
          interval: 50;
        "
        cursor="
          fuse: false;
          rayOrigin: mouse;
          fuseTimeout: 1500;
        ">
        <!-- Cursor visual feedback (center of screen) -->
        <a-entity
          position="0 0 -0.5"
          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
          material="color: white; shader: flat; opacity: 0.9"
          id="cursor-ring"
          cursor-feedback>
        </a-entity>
      </a-camera>

    </a-entity>

    <!-- Mobile Touch Controls (separate entity) -->
    <a-entity
      mobile-touch-controls="
        enabled: true;
        movementSpeed: 3.5;
        lookSensitivity: 0.003;
      ">
    </a-entity>

    <!-- Teleport Navigation (separate entity) -->
    <a-entity
      teleport-navigation="
        enabled: true;
        maxDistance: 10;
        transitionDuration: 800;
      ">
    </a-entity>

    <!-- Lighting System -->
    <!-- Ambient Light (overall illumination) -->
    <a-entity
      light="
        type: ambient;
        color: #FFFFFF;
        intensity: 0.6;
      ">
    </a-entity>

    <!-- Directional Light (simulating sun) -->
    <a-entity
      light="
        type: directional;
        color: #FFFFFF;
        intensity: 0.8;
        castShadow: true;
        shadowMapHeight: 1024;
        shadowMapWidth: 1024;
      "
      position="5 10 5">
    </a-entity>

    <!-- Hemisphere Light (sky/ground gradient) -->
    <a-entity
      light="
        type: hemisphere;
        color: #87CEEB;
        groundColor: #7BC8A4;
        intensity: 0.5;
      ">
    </a-entity>

  </a-scene>

  <!-- HUD Overlay -->
  <div id="hud">
    <div id="header">
      <span id="museum-title">B·∫£o t√†ng ·∫¢o Nguy·ªÖn √Åi Qu·ªëc</span>
      <div class="header-controls">
        <button class="header-button icon-button" id="audio-toggle" title="Toggle Audio">üîä</button>
        <button class="header-button icon-button" id="help-button" title="Help">‚ùì</button>
      </div>
    </div>
    <div id="crosshair"></div>
    <div id="footer">
      <span id="room-name">Ph√≤ng Kh·ªüi ƒë·∫ßu</span>
      <span id="progress">0/3</span>
    </div>
  </div>

</body>
</html>
